# 图书馆管理系统 - 运行操作手册

## 📋 目录

1. [系统概述](#系统概述)
2. [环境要求](#环境要求)
3. [快速启动](#快速启动)
4. [详细启动步骤](#详细启动步骤)
5. [功能模块使用](#功能模块使用)
6. [常见问题](#常见问题)
7. [系统架构](#系统架构)

---

## 系统概述

**图书馆管理系统**是一个基于 RuoYi-Vue 框架开发的现代化图书管理平台，包含管理后台和用户端两大模块。

### 主要功能
- 📚 图书管理（增删改查、分类管理）
- 👥 读者管理（读者信息、借书证管理）
- 📖 借阅管理（借书、还书、续借）
- 🎨 用户端界面（书架浏览、图书检索）
- 📊 数据统计与报表导出

### 技术栈
- **后端**: Spring Boot + MyBatis + MySQL + Redis
- **前端**: Vue 3 + Element Plus
- **容器化**: Docker + Docker Compose

---

## 环境要求

### 必需软件

| 软件 | 版本要求 | 用途 |
|------|---------|------|
| JDK | 1.8+ | 运行后端服务 |
| Node.js | 14+ | 运行前端服务 |
| Maven | 3.6+ | 构建后端项目 |
| Docker Desktop | 最新版 | 运行数据库和缓存 |

### 端口占用

确保以下端口未被占用：

- **3307**: MySQL 数据库
- **6379**: Redis 缓存
- **8080**: 后端服务
- **80**: 前端服务

---

## 快速启动

### 方式一：一键启动（推荐）

1. **启动数据库和缓存**
   ```bash
   cd library-management-system
   .\deploy-docker.bat
   ```
   > 等待提示 "MySQL 和 Redis 已启动"

2. **启动后端**
   - 使用 IntelliJ IDEA 打开 `ruoyi-backend` 目录
   - 运行 `com.ruoyi.RuoYiApplication` 主类
   - 等待控制台显示 "启动成功"

3. **启动前端**
   ```bash
   cd ruoyi-ui
   npm run dev
   ```
   > 首次运行需先执行 `npm install`

4. **访问系统**
   - 管理后台: http://localhost:80
   - 用户端: http://localhost:80/user-library

### 方式二：手动启动

参见 [详细启动步骤](#详细启动步骤)

---

## 详细启动步骤

### 1. 启动数据库服务

#### 使用 Docker（推荐）

```bash
# 进入项目目录
cd library-management-system

# 启动 MySQL 和 Redis
docker-compose up -d mysql redis

# 验证服务状态
docker ps
```

**预期输出**：
```
CONTAINER ID   IMAGE          STATUS         PORTS
xxxxx          mysql:8.0      Up 2 minutes   0.0.0.0:3307->3306/tcp
xxxxx          redis:7-alpine Up 2 minutes   0.0.0.0:6379->6379/tcp
```

#### 数据库初始化

数据库会在首次启动时自动初始化，包含：
- ✅ 基础表结构（用户、角色、权限等）
- ✅ 图书馆业务表（图书、分类、读者、借阅记录）
- ✅ 初始数据（管理员账号、字典数据）

**默认管理员账号**：
- 用户名: `admin`
- 密码: `admin123`

### 2. 启动后端服务

#### 在 IntelliJ IDEA 中

1. **打开项目**
   - File → Open → 选择 `ruoyi-backend` 目录

2. **配置 JDK**
   - File → Project Structure → Project SDK → 选择 JDK 1.8

3. **Maven 构建**
   - 右侧 Maven 面板 → 点击刷新
   - 等待依赖下载完成

4. **运行主类**
   - 找到 `ruoyi-admin/src/main/java/com/ruoyi/RuoYiApplication.java`
   - 右键 → Run 'RuoYiApplication'

**启动成功标志**：
```
----------------------------------------------------------
Application RuoYi-Vue is running! Access URLs:
Local:      http://localhost:8080/
----------------------------------------------------------
```

#### 验证后端

访问 Swagger 文档：http://localhost:8080/swagger-ui.html

### 3. 启动前端服务

#### 首次运行

```bash
cd ruoyi-ui

# 安装依赖（仅首次需要，约需5-10分钟）
npm install

# 启动开发服务器
npm run dev
```

#### 后续运行

```bash
cd ruoyi-ui
npm run dev
```

**启动成功标志**：
```
  VITE ready in 1234 ms

  ➜  Local:   http://localhost:80/
  ➜  Network: use --host to expose
```

### 4. 访问系统

#### 管理后台

1. 打开浏览器访问: http://localhost:80
2. 登录页面输入：
   - 用户名: `admin`
   - 密码: `admin123`
   - 验证码: 根据图片输入
3. 登录后进入管理后台

#### 用户端界面

直接访问: http://localhost:80/user-library

**三个主要页面**：
- **首页**: `/user-library` - 精选推荐、分类浏览
- **浏览图书**: `/user-library/browse` - 书架式布局、高级筛选
- **我的书架**: `/user-library/my-library` - 借阅管理（需登录）

---

## 功能模块使用

### 📚 图书管理

#### 1. 查看图书列表

**路径**: 图书管理 → 图书信息

**功能**:
- 📖 查看所有图书（包含172本预装图书）
- 🔍 多条件搜索（书名、作者、ISBN、分类、状态）
- 📊 查看库存状态（可借数量实时显示）

#### 2. 添加新图书

**步骤**:
1. 点击"新增"按钮
2. 填写图书信息：
   - **必填**: 书名、图书分类、总库存
   - 可选: ISBN、作者、出版社、价格等
3. 点击"确定"保存

**提示**: 添加新书时，可借数量会自动等于总库存

#### 3. 修改图书信息

1. 在列表中找到目标图书
2. 点击"修改"按钮
3. 更新信息后保存

#### 4. 删除图书

- 单个删除: 点击图书行的"删除"按钮
- 批量删除: 勾选多本图书 → 点击顶部"删除"按钮

#### 5. 导出图书数据

点击"导出"按钮 → 下载 Excel 文件

### 🏷️ 分类管理

**路径**: 图书管理 → 图书分类

**预设分类**:
- 分类1: 计算机/编程
- 分类2: 文学小说
- 分类3: 历史哲学
- 分类4: 经管励志

**操作**:
- ➕ 新增分类（支持多级分类）
- ✏️ 修改分类名称
- 🗑️ 删除分类（如果分类下有图书则无法删除）

### 👥 读者管理

**路径**: 图书管理 → 读者信息

**功能**:
- 添加读者（姓名、借书证号、联系方式）
- 设置借阅权限（最大借阅数量、最大借阅天数）
- 读者类型: 普通读者、VIP、教师、学生
- 状态管理: 正常、停用、冻结

### 📖 借阅管理

**路径**: 图书管理 → 借阅记录

#### 1. 办理借书

1. 点击"办理借书"
2. 选择读者
3. 选择图书
4. 确认借阅

系统会自动：
- ✅ 检查读者借阅数量限制
- ✅ 检查图书库存
- ✅ 生成借阅记录
- ✅ 更新库存数量

#### 2. 办理还书

1. 在借阅记录中找到对应记录
2. 点击"归还"按钮
3. 确认归还

系统会自动：
- ✅ 记录归还时间
- ✅ 恢复图书库存
- ✅ 检查是否逾期

#### 3. 办理续借

- 条件: 未逾期且续借次数 < 2次
- 效果: 延长30天借阅期限

### 🎨 用户端使用

#### 首页功能

1. **搜索图书**: 支持书名、作者、ISBN搜索
2. **浏览统计**: 查看总藏书量、在借图书数量
3. **精选推荐**: 展示最新入库的6本图书
4. **分类导航**: 快速进入各个图书分类

#### 浏览页面

**特色书架布局**:
- 📚 书籍垂直摆放在木质书架上
- 🎯 悬停显示详细信息卡片
- 🔍 侧边栏多维度筛选

**筛选选项**:
- **分类筛选**: 按图书分类过滤
- **库存状态**: 全部 / 可借阅 / 已借出
- **排序方式**: 最新入库 / 书名 / 作者

**使用技巧**:
- 点击书籍 → 查看详情对话框
- 点击"立即借阅" → 提示需要登录

#### 我的书架（待实现）

> ⚠️ 注意: 此功能需要用户认证系统，当前显示"需要登录"提示

**计划功能**:
- 查看当前在借图书
- 查看借阅历史
- 一键续借
- 一键归还

---

## 常见问题

### 启动相关

#### Q1: Docker启动失败？

**检查清单**:
```bash
# 1. 检查Docker是否运行
docker ps

# 2. 检查端口占用
netstat -ano | findstr "3307"
netstat -ano | findstr "6379"

# 3. 查看容器日志
docker logs library-mysql
docker logs library-redis
```

**解决方案**:
- 如果端口被占用，关闭占用的进程或修改 `docker-compose.yml` 中的端口映射
- 如果Docker未启动，启动 Docker Desktop

#### Q2: 后端启动报错 "连接数据库失败"？

**原因**: MySQL 容器未就绪

**解决**:
```bash
# 等待30秒让MySQL完全启动
# 或检查MySQL日志
docker logs library-mysql

# 看到以下内容表示MySQL已就绪:
# ready for connections. Version: '8.0.x'
```

#### Q3: 前端启动报错 ENOENT?

**原因**: 在错误的目录运行命令

**解决**:
```bash
# 必须在 ruoyi-ui 目录下运行
cd ruoyi-ui
npm run dev
```

#### Q4: 前端端口80被占用？

**解决方案1**: 修改前端端口
```javascript
// ruoyi-ui/vite.config.js
export default {
  server: {
    port: 8081,  // 改为其他端口
    // ...
  }
}
```

**解决方案2**: 关闭占用80端口的程序

### 使用相关

#### Q5: 登录时验证码错误？

**解决**:
- 仔细看清验证码图片（math类型，需要计算数学表达式）
- 例如: `1+2=?` 应输入 `3`
- 刷新页面重新获取验证码

#### Q6: 图书列表为空？

**检查**:
```bash
# 进入MySQL容器
docker exec -it library-mysql mysql -uroot -proot

# 查询图书数量
USE `ry-vue`;
SELECT COUNT(*) FROM lib_book;
```

**预期结果**: 应显示 172（或更多）

**如果为0**: 重新运行导入脚本
```bash
python import_batch2.py
python import_batch3.py
```

#### Q7: 用户端显示"需要登录"？

**说明**: 这是正常的！

当前版本的借阅功能需要用户认证系统支持，该功能预留了接口，待后续实现：
- 读者登录/注册
- Session管理
- 实际的借阅/归还操作

#### Q8: 中文显示乱码？

**数据库层面已修复**: 
所有SQL文件开头已添加 `SET NAMES utf8mb4;`

**如果仍有问题**:
1. 硬刷新浏览器 (Ctrl + F5)
2. 重启后端服务
3. 检查MySQL字符集:
   ```sql
   SHOW VARIABLES LIKE 'character%';
   ```

### 数据相关

#### Q9: 如何重置数据库？

```bash
# 1. 停止并删除容器和数据卷
docker-compose down -v

# 2. 重新启动（会自动初始化）
docker-compose up -d mysql redis

# 3. 等待30秒后，重新导入图书数据
python direct_import.py
python import_batch2.py
python import_batch3.py
```

#### Q10: 如何备份数据？

```bash
# 导出所有数据
docker exec library-mysql mysqldump -uroot -proot ry-vue > backup_$(date +%Y%m%d).sql

# 恢复数据
docker exec -i library-mysql mysql -uroot -proot ry-vue < backup_20260104.sql
```

---

## 系统架构

### 目录结构

```
library-management-system/
├── ruoyi-backend/          # 后端项目
│   ├── ruoyi-admin/        # 主启动模块
│   ├── ruoyi-common/       # 通用模块
│   ├── ruoyi-framework/    # 框架模块
│   ├── ruoyi-library/      # 图书馆业务模块 ★
│   └── ruoyi-system/       # 系统模块
├── ruoyi-ui/               # 前端项目
│   ├── src/
│   │   ├── api/            # API接口
│   │   ├── views/
│   │   │   ├── library/    # 管理后台页面
│   │   │   └── user-library/ # 用户端页面 ★
│   │   └── router/         # 路由配置
│   └── public/
├── sql/                    # 数据库脚本
│   ├── 00_ry_20250522.sql # 基础表结构
│   ├── library_tables.sql  # 图书馆表结构
│   └── books_data_200.sql  # 图书数据
├── docker-compose.yml      # Docker配置
└── deploy-docker.bat       # 一键启动脚本
```

### 数据库表结构

#### 核心业务表

| 表名 | 说明 | 主要字段 |
|------|------|---------|
| `lib_book` | 图书信息 | book_id, isbn, book_name, author, category_id, total_quantity, available_quantity |
| `lib_category` | 图书分类 | category_id, parent_id, category_name |
| `lib_reader` | 读者信息 | reader_id, card_no, reader_name, max_borrow_count |
| `lib_borrow_record` | 借阅记录 | record_id, book_id, reader_id, borrow_date, due_date, return_date, status |

### API 端点

#### 图书管理
```
GET    /library/book/list              # 查询图书列表
GET    /library/book/{bookId}          # 获取图书详情
POST   /library/book                    # 新增图书
PUT    /library/book                    # 修改图书
DELETE /library/book/{bookIds}          # 删除图书
POST   /library/book/export             # 导出图书
```

#### 分类管理
```
GET    /library/category/list           # 查询分类（树形）
POST   /library/category                # 新增分类
PUT    /library/category                # 修改分类
DELETE /library/category/{categoryId}   # 删除分类
```

#### 借阅管理
```
GET    /library/borrow/list             # 查询借阅记录
POST   /library/borrow/borrow/{bookId}/{readerId}  # 办理借书
POST   /library/borrow/return/{recordId}           # 办理还书
POST   /library/borrow/renew/{recordId}            # 办理续借
GET    /library/borrow/borrowing/{readerId}       # 查询读者在借图书
```

### 技术特性

#### 后端特性
- ✅ RESTful API 设计
- ✅ MyBatis-Plus 增强
- ✅ Redis 缓存支持
- ✅ JWT Token 认证
- ✅ 数据权限控制
- ✅ 操作日志记录
- ✅ Swagger API 文档

#### 前端特性
- ✅ Vue 3 Composition API
- ✅ Element Plus UI 组件库
- ✅ Pinia 状态管理
- ✅ Vue Router 路由管理
- ✅ Axios 请求封装
- ✅ 响应式设计
- ✅ Academic Elegance 设计风格（用户端）

---

## 开发说明

### 添加新功能

1. **后端**: 在 `ruoyi-library` 模块添加 Controller、Service、Mapper
2. **前端**: 在 `src/views/library` 添加Vue页面
3. **权限**: 在系统管理 → 菜单管理中添加菜单权限

### 代码生成

RuoYi框架提供了代码生成工具：

1. 访问: 系统工具 → 代码生成
2. 导入要生成的表
3. 编辑配置（模块名、包路径等）
4. 点击生成代码
5. 下载并导入到项目中

### 调试技巧

**后端调试**:
- IntelliJ IDEA 断点调试
- 查看控制台日志
- Swagger 测试 API

**前端调试**:
- Chrome DevTools
- Vue DevTools 插件
- Network 面板查看请求

---

## 附录

### 快捷脚本

#### 完全重启系统

```bash
# Windows
.\restart-all.bat

# 内容:
docker-compose restart mysql redis
# 然后重启后端和前端
```

#### 查看服务状态

```bash
# 检查所有Docker容器
docker ps -a

# 检查后端端口
netstat -ano | findstr "8080"

# 检查前端端口
netstat -ano | findstr "80"
```

### 联系与支持

- **项目文档**: `/运行操作手册.md`
- **API文档**: http://localhost:8080/swagger-ui.html
- **Walkthrough**: `C:\Users\jion\.gemini\antigravity\brain\...\walkthrough.md`

---

## 版本信息

- **版本号**: v1.0.0
- **更新日期**: 2026-01-04
- **图书数据量**: 172本
- **技术框架**: RuoYi-Vue 3.9.1

---

**🎉 祝您使用愉快！**

如有问题，请查阅本手册的"常见问题"章节。
